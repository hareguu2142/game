<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>수학 대결 게임</title>
    <style>
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    min-height: 100vh;
    background-color: #f0f2f5;
    margin: 0;
    padding: 20px;
    box-sizing: border-box;
}

.container {
    background-color: #fff;
    padding: 25px;
    border-radius: 10px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    width: 100%;
    max-width: 700px;
    text-align: center;
}

h1, h2, h3 {
    color: #333;
}

h1 {
    margin-bottom: 20px;
    font-size: 2em;
    color: #007bff;
}

h2 {
    margin-top: 30px;
    margin-bottom: 15px;
    font-size: 1.5em;
    border-bottom: 2px solid #eee;
    padding-bottom: 5px;
}

h3 {
    font-size: 1.2em;
    margin-bottom: 10px;
}

.moderator-controls button,
.player-interaction button,
.score-area button {
    background-color: #007bff;
    color: white;
    border: none;
    padding: 10px 15px;
    margin: 5px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 1em;
    transition: background-color 0.3s ease;
}

.moderator-controls button:hover,
.player-interaction button:hover,
.score-area button:hover {
    background-color: #0056b3;
}

#revealAnswerBtn {
    background-color: #28a745;
}
#revealAnswerBtn:hover {
    background-color: #1e7e34;
}

#startNewSetBtn {
    background-color: #17a2b8;
}
#startNewSetBtn:hover {
    background-color: #117a8b;
}

#resetScoresBtn {
    background-color: #dc3545;
}
#resetScoresBtn:hover {
    background-color: #c82333;
}

.game-area {
    display: flex;
    justify-content: space-around;
    margin: 20px 0;
    padding: 15px;
    background-color: #e9ecef;
    border-radius: 8px;
}

.numbers-display, .target-display {
    padding: 10px;
    min-width: 200px;
}

#numberPool {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 10px;
    margin-top: 10px;
}

.number-item {
    background-color: #ffc107;
    color: #333;
    padding: 10px 15px;
    border-radius: 5px;
    font-size: 1.4em;
    font-weight: bold;
    min-width: 40px;
    text-align: center;
}

#targetNumberDisplay {
    font-size: 2.5em;
    font-weight: bold;
    color: #dc3545;
    padding: 10px;
    background-color: #fff;
    border: 2px dashed #dc3545;
    border-radius: 5px;
    min-height: 50px;
    display: flex;
    justify-content: center;
    align-items: center;
}

.player-btn {
    padding: 12px 20px !important;
    font-size: 1.1em !important;
}

#hapBtn {
    background-color: #28a745;
}
#hapBtn:hover {
    background-color: #1e7e34;
}

#boolBtn {
    background-color: #dc3545;
}
#boolBtn:hover {
    background-color: #c82333;
}

.message {
    margin-top: 20px;
    padding: 15px;
    border-radius: 5px;
    font-size: 1.1em;
    font-weight: bold;
    min-height: 20px;
}

.message.success {
    background-color: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
}

.message.error {
    background-color: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
}

.message.info {
    background-color: #d1ecf1;
    color: #0c5460;
    border: 1px solid #bee5eb;
}

.score-area {
    margin-top: 30px;
}

.player-score {
    margin: 10px 0;
    font-size: 1.1em;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
}

.player-score span {
    min-width: 150px;
    text-align: left;
}

.player-score button {
    font-size: 0.9em;
    padding: 5px 10px;
}
    </style>
</head>
<body>
    <div class="container">
        <h1>수학 대결! 합/불 게임</h1>

        <div class="moderator-controls">
            <h2>사회자 컨트롤 패널</h2>
            <button id="startNewSetBtn">새 숫자 세트 시작 (8개)</button>
            <button id="nextProblemBtn">다음 문제 (숫자 1개 제거)</button>
            <button id="revealAnswerBtn">정답 공개</button>
        </div>

        <div class="game-area">
            <div class="numbers-display">
                <h3>주어진 숫자 (<span id="remainingCount">8</span>개):</h3>
                <div id="numberPool"></div>
            </div>
            <div class="target-display">
                <h3>목표 숫자:</h3>
                <div id="targetNumberDisplay">?</div>
            </div>
        </div>

        <div class="player-interaction">
            <h2>플레이어 외침 확인 (사회자 클릭)</h2>
            <button id="hapBtn" class="player-btn">"합"이라고 외쳤을 때</button>
            <button id="boolBtn" class="player-btn">"불"이라고 외쳤을 때</button>
        </div>
        
        <div id="messageArea" class="message"></div>


        <div class="score-area">
            <h2>점수판</h2>
            <div class="player-score">
                <span>플레이어 1: <span id="player1Score">0</span> 점</span>
                <button onclick="updateScore('player1', 1)">+1점</button>
                <button onclick="updateScore('player1', -1)">-1점</button>
            </div>
            <div class="player-score">
                <span>플레이어 2: <span id="player2Score">0</span> 점</span>
                <button onclick="updateScore('player2', 1)">+1점</button>
                <button onclick="updateScore('player2', -1)">-1점</button>
            </div>
            <button id="resetScoresBtn">점수 초기화</button>
        </div>
    </div>

    <script>
document.addEventListener('DOMContentLoaded', () => {
    const numberPoolDiv = document.getElementById('numberPool');
    const targetNumberDisplayDiv = document.getElementById('targetNumberDisplay');
    const remainingCountSpan = document.getElementById('remainingCount');
    const messageAreaDiv = document.getElementById('messageArea');
    
    const startNewSetBtn = document.getElementById('startNewSetBtn');
    const nextProblemBtn = document.getElementById('nextProblemBtn');
    const revealAnswerBtn = document.getElementById('revealAnswerBtn');
    const hapBtn = document.getElementById('hapBtn');
    const boolBtn = document.getElementById('boolBtn');
    const resetScoresBtn = document.getElementById('resetScoresBtn');

    let currentNumbers = [];
    let targetNumber = 0;
    let actualSolutions = [];
    let isActuallyHap = false;

    let scores = {
        player1: 0,
        player2: 0
    };

    function generateUniqueRandomNumbers(count, min, max) {
        const numbers = new Set();
        while (numbers.size < count) {
            numbers.add(Math.floor(Math.random() * (max - min + 1)) + min);
        }
        return Array.from(numbers);
    }

    function displayNumbers() {
        numberPoolDiv.innerHTML = '';
        currentNumbers.forEach(num => {
            const numDiv = document.createElement('div');
            numDiv.classList.add('number-item');
            numDiv.textContent = num;
            numberPoolDiv.appendChild(numDiv);
        });
        remainingCountSpan.textContent = currentNumbers.length;
    }

    function getAllPossible3Sums(numbers) {
        const sums = new Set();
        if (numbers.length < 3) return [];

        for (let i = 0; i < numbers.length - 2; i++) {
            for (let j = i + 1; j < numbers.length - 1; j++) {
                for (let k = j + 1; k < numbers.length; k++) {
                    sums.add(numbers[i] + numbers[j] + numbers[k]);
                }
            }
        }
        return Array.from(sums).sort((a, b) => a - b);
    }

    function generateTargetAndSolutions() {
        if (currentNumbers.length < 3) {
            targetNumberDisplayDiv.textContent = "-";
            isActuallyHap = false;
            actualSolutions = [];
            displayMessage("숫자가 부족하여 합/불 문제를 만들 수 없습니다. 새 세트를 시작하세요.", "info");
            return false;
        }

        const possibleSums = getAllPossible3Sums(currentNumbers);
        
        if (possibleSums.length === 0) {
            targetNumber = currentNumbers.reduce((a,b)=>a+b,0) + 10;
            isActuallyHap = false;
            actualSolutions = [];
        } else {
            const minSum = possibleSums[0];
            const maxSum = possibleSums[possibleSums.length - 1];
            
            targetNumber = Math.floor(Math.random() * (maxSum - minSum + 1)) + minSum;
            actualSolutions = findSumCombinations(currentNumbers, targetNumber);
            isActuallyHap = actualSolutions.length > 0;
        }
        
        targetNumberDisplayDiv.textContent = targetNumber;
        return true;
    }

    function findSumCombinations(numbers, target) {
        const solutions = [];
        const n = numbers.length;
        if (n < 3) return solutions;

        for (let i = 0; i < n - 2; i++) {
            for (let j = i + 1; j < n - 1; j++) {
                for (let k = j + 1; k < n; k++) {
                    if (numbers[i] + numbers[j] + numbers[k] === target) {
                        solutions.push([numbers[i], numbers[j], numbers[k]].sort((a,b)=>a-b));
                    }
                }
            }
        }
        if (solutions.length > 0) {
            const uniqueSolutions = Array.from(new Set(solutions.map(s => JSON.stringify(s)))).map(s => JSON.parse(s));
            return uniqueSolutions;
        }
        return [];
    }

    function startNewSet() {
        currentNumbers = generateUniqueRandomNumbers(8, 1, 15);
        displayNumbers();
        if (generateTargetAndSolutions()) {
             displayMessage("새로운 숫자 세트와 목표 숫자가 준비되었습니다.", "info");
        }
        nextProblemBtn.disabled = false;
    }

    function nextProblem() {
        if (currentNumbers.length <= 5) {
            displayMessage("라운드 종료! 새로운 숫자 8개로 시작합니다.", "info");
            startNewSet();
            return;
        }

        if (currentNumbers.length > 3) {
            const removeIndex = Math.floor(Math.random() * currentNumbers.length);
            const removedNumber = currentNumbers.splice(removeIndex, 1)[0];
            displayNumbers();
            if (generateTargetAndSolutions()) {
                displayMessage(`${removedNumber}이(가) 제거되었습니다. 새 목표 숫자가 설정되었습니다.`, "info");
            }
        } else {
             displayMessage("더 이상 숫자를 제거할 수 없습니다. 새 숫자 세트를 시작하세요.", "error");
             nextProblemBtn.disabled = true;
        }
    }
    
    hapBtn.addEventListener('click', () => {
        if (targetNumberDisplayDiv.textContent === '?' || targetNumberDisplayDiv.textContent === '-') {
            displayMessage("먼저 게임을 시작하거나 다음 문제를 진행해주세요.", "error");
            return;
        }
        if (isActuallyHap) {
            displayMessage(`정답! "합"이 맞습니다. (예: ${actualSolutions[0].join(' + ')})`, "success");
        } else {
            displayMessage(`땡! 실제로는 "불"입니다. 이 숫자로 ${targetNumber}을 만들 수 없습니다.`, "error");
        }
    });

    boolBtn.addEventListener('click', () => {
         if (targetNumberDisplayDiv.textContent === '?' || targetNumberDisplayDiv.textContent === '-') {
            displayMessage("먼저 게임을 시작하거나 다음 문제를 진행해주세요.", "error");
            return;
        }
        if (!isActuallyHap) {
            displayMessage("정답! 불이 맞습니다.", "success");
        } else {
            displayMessage(`땡! 실제로는 "합"입니다. (예: ${actualSolutions[0].join(' + ')})`, "error");
        }
    });

    revealAnswerBtn.addEventListener('click', () => {
        if (targetNumberDisplayDiv.textContent === '?' || targetNumberDisplayDiv.textContent === '-') {
            displayMessage("먼저 게임을 시작하거나 다음 문제를 진행해주세요.", "error");
            return;
        }
        if (isActuallyHap) {
            let solutionString = actualSolutions.map(sol => sol.join(' + ')).join(' 또는 ');
            displayMessage(`정답은 "합"입니다. 가능한 조합: ${solutionString} = ${targetNumber}`, "info");
        } else {
            displayMessage(`정답은 "불"입니다. ${targetNumber}을 만들 수 있는 조합이 없습니다.`, "info");
        }
    });

    window.updateScore = function(player, change) {
        scores[player] += change;
        if (scores[player] < 0) scores[player] = 0;
        document.getElementById(`${player}Score`).textContent = scores[player];
    }

    resetScoresBtn.addEventListener('click', () => {
        scores.player1 = 0;
        scores.player2 = 0;
        document.getElementById('player1Score').textContent = 0;
        document.getElementById('player2Score').textContent = 0;
        displayMessage("점수가 초기화되었습니다.", "info");
    });

    function displayMessage(msg, type = "info") {
        messageAreaDiv.textContent = msg;
        messageAreaDiv.className = 'message';
        if (type) {
            messageAreaDiv.classList.add(type);
        }
    }

    startNewSetBtn.addEventListener('click', startNewSet);
    nextProblemBtn.addEventListener('click', nextProblem);
    
    displayMessage("새 숫자 세트 시작 버튼을 눌러 게임을 시작하세요.", "info");
    targetNumberDisplayDiv.textContent = '?';
    nextProblemBtn.disabled = true;
});
    </script>
</body>
</html>
