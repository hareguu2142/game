<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>수학 대결 게임</title>
    <style>
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    min-height: 100vh;
    background-color: #f0f2f5;
    margin: 0;
    padding: 20px;
    box-sizing: border-box;
}

.container {
    background-color: #fff;
    padding: 25px;
    border-radius: 10px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    width: 100%;
    max-width: 700px;
    text-align: center;
}

h1, h2, h3 {
    color: #333;
}

h1 {
    margin-bottom: 20px;
    font-size: 2em;
    color: #007bff;
}

h2 {
    margin-top: 30px;
    margin-bottom: 15px;
    font-size: 1.5em;
    border-bottom: 2px solid #eee;
    padding-bottom: 5px;
}

h3 {
    font-size: 1.2em;
    margin-bottom: 10px;
}

.moderator-controls button,
.player-interaction button,
.score-area button {
    background-color: #007bff;
    color: white;
    border: none;
    padding: 10px 15px;
    margin: 5px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 1em;
    transition: background-color 0.3s ease;
}

.moderator-controls button:hover,
.player-interaction button:hover,
.score-area button:hover {
    background-color: #0056b3;
}

#revealAnswerBtn {
    background-color: #28a745;
}
#revealAnswerBtn:hover {
    background-color: #1e7e34;
}

#startNewSetBtn {
    background-color: #17a2b8;
}
#startNewSetBtn:hover {
    background-color: #117a8b;
}

#resetScoresBtn {
    background-color: #dc3545;
}
#resetScoresBtn:hover {
    background-color: #c82333;
}

.game-area {
    display: flex;
    justify-content: space-around;
    margin: 20px 0;
    padding: 15px;
    background-color: #e9ecef;
    border-radius: 8px;
}

.numbers-display, .target-display {
    padding: 10px;
    min-width: 200px;
}

#numberPool {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 10px;
    margin-top: 10px;
}

.number-item {
    background-color: #ffc107;
    color: #333;
    padding: 10px 15px;
    border-radius: 5px;
    font-size: 1.4em;
    font-weight: bold;
    min-width: 40px;
    text-align: center;
}

#targetNumberDisplay {
    font-size: 2.5em;
    font-weight: bold;
    color: #dc3545;
    padding: 10px;
    background-color: #fff;
    border: 2px dashed #dc3545;
    border-radius: 5px;
    min-height: 50px;
    display: flex;
    justify-content: center;
    align-items: center;
}

.player-btn {
    padding: 12px 20px !important;
    font-size: 1.1em !important;
}

#hapBtn {
    background-color: #28a745;
}
#hapBtn:hover {
    background-color: #1e7e34;
}

#boolBtn {
    background-color: #dc3545;
}
#boolBtn:hover {
    background-color: #c82333;
}

.message {
    margin-top: 20px;
    padding: 15px;
    border-radius: 5px;
    font-size: 1.1em;
    font-weight: bold;
    min-height: 20px;
}

.message.success {
    background-color: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
}

.message.error {
    background-color: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
}

.message.info {
    background-color: #d1ecf1;
    color: #0c5460;
    border: 1px solid #bee5eb;
}

.score-area {
    margin-top: 30px;
}

.player-score {
    margin: 10px 0;
    font-size: 1.1em;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
}

.player-score span {
    min-width: 150px;
    text-align: left;
}

.player-score button {
    font-size: 0.9em;
    padding: 5px 10px;
}

.rules-section {
    margin-top: 20px;
    margin-bottom: 20px;
    padding: 15px;
    background-color: #f8f9fa;
    border-radius: 5px;
    border: 1px solid #dee2e6;
    text-align: left;
}

.rules-section h3 {
    margin-top: 0;
    margin-bottom: 10px;
    font-size: 1.3em;
    color: #495057;
    text-align: center;
    border-bottom: 1px solid #ced4da;
    padding-bottom: 5px;
}

.rules-list {
    list-style-type: disc;
    padding-left: 20px;
    margin: 0;
}

.rules-list li {
    margin-bottom: 8px;
    color: #212529;
    font-size: 1em;
    line-height: 1.5;
}
    </style>
</head>
<body>
    <div class="container">
        <h1>수학 대결! 합/불 게임</h1>

        <div class="moderator-controls">
            <h2>사회자 컨트롤 패널</h2>
            <button id="startNewSetBtn">새 숫자 세트 시작 (8개)</button>
            <button id="nextProblemBtn">다음 문제 (숫자 1개 제거)</button>
            <button id="revealAnswerBtn">정답 공개</button>
        </div>

        <div class="game-area">
            <div class="numbers-display">
                <h3>주어진 숫자 (<span id="remainingCount">8</span>개):</h3>
                <div id="numberPool"></div>
            </div>
            <div class="target-display">
                <h3>목표 숫자:</h3>
                <div id="targetNumberDisplay">?</div>
            </div>
        </div>

        <div class="player-interaction">
            <h2>플레이어 외침 확인 (사회자 클릭)</h2>
            <button id="hapBtn" class="player-btn">"합"이라고 외쳤을 때</button>
            <button id="boolBtn" class="player-btn">"불"이라고 외쳤을 때</button>
        </div>
        
        <div id="messageArea" class="message"></div>


        <div class="score-area">
            <h2>점수판</h2>
            <div class="player-score">
                <span>플레이어 1: <span id="player1Score">0</span> 점</span>
                <button onclick="updateScore('player1', 1)">+1점 (정답)</button>
                <button onclick="updateScore('player1', -2)">-2점 (오답)</button>
            </div>
            <div class="player-score">
                <span>플레이어 2: <span id="player2Score">0</span> 점</span>
                <button onclick="updateScore('player2', 1)">+1점 (정답)</button>
                <button onclick="updateScore('player2', -2)">-2점 (오답)</button>
            </div>

            <div class="rules-section">
                <h3>게임 룰</h3>
                <ul class="rules-list">
                    <li><strong>게임 목표:</strong> 사회자가 제시하는 <strong>목표 숫자</strong>를 <strong>주어진 숫자들 중 3개를 더하여</strong> 만들 수 있는지 맞추는 게임입니다.</li>
                    <li><strong>"합" 외치기:</strong> 목표 숫자를 만들 수 있다고 생각하면 "합!"을 외칩니다.
                        <ul>
                            <li>정답 ("합"이 맞는 경우): +1점</li>
                            <li>오답 ("불"이 맞는 경우): -2점</li>
                        </ul>
                    </li>
                    <li><strong>"불" 외치기:</strong> 목표 숫자를 만들 수 없다고 생각하면 "불!"을 외칩니다.
                        <ul>
                            <li>정답 ("불"이 맞는 경우): +1점</li>
                            <li>오답 ("합"이 맞는 경우): -2점</li>
                        </ul>
                    </li>
                    <li><strong>게임 진행:</strong>
                        <ol>
                            <li>사회자는 "새 숫자 세트 시작" 버튼으로 8개의 숫자를 공개하고 목표 숫자를 제시합니다.</li>
                            <li>플레이어는 "합" 또는 "불"을 외칠 기회를 얻습니다. (가장 먼저 외친 플레이어에게 기회)</li>
                            <li>사회자는 플레이어의 외침에 따라 "합" 또는 "불" 버튼을 클릭하여 정오답을 확인합니다.</li>
                            <li>"다음 문제" 버튼을 누르면 주어진 숫자 중 하나가 랜덤하게 제거되고, 새로운 목표 숫자가 제시됩니다. 이 과정은 숫자가 5개가 남을 때까지 반복됩니다.</li>
                            <li>숫자가 5개가 남은 상태에서 문제가 출제된 후 "다음 문제"를 누르면 해당 라운드가 종료되고 동시에, 새로운 8개의 숫자로 시작합니다.</li>
                        </ol>
                    </li>
                    <li><strong>점수:</strong> 점수는 음수가 될 수 있습니다.</li>
                    <li><strong>승리 조건:</strong> 정해진 라운드 수 이후 또는 특정 시간 이후 가장 높은 점수를 얻은 플레이어가 승리합니다. (사회자 재량)</li>
                    <li><strong>사회자 기능:</strong>
                        <ul>
                            <li>"정답 공개": 현재 문제의 정답("합" 또는 "불")과 "합"일 경우 가능한 숫자 조합을 보여줍니다.</li>
                            <li>"점수 초기화": 모든 플레이어의 점수를 0으로 초기화합니다.</li>
                        </ul>
                    </li>
                </ul>
            </div>
            <button id="resetScoresBtn">점수 초기화</button>
        </div>
    </div>

    <script>
document.addEventListener('DOMContentLoaded', () => {
    const numberPoolDiv = document.getElementById('numberPool');
    const targetNumberDisplayDiv = document.getElementById('targetNumberDisplay');
    const remainingCountSpan = document.getElementById('remainingCount');
    const messageAreaDiv = document.getElementById('messageArea');
    
    const startNewSetBtn = document.getElementById('startNewSetBtn');
    const nextProblemBtn = document.getElementById('nextProblemBtn');
    const revealAnswerBtn = document.getElementById('revealAnswerBtn');
    const hapBtn = document.getElementById('hapBtn');
    const boolBtn = document.getElementById('boolBtn');
    const resetScoresBtn = document.getElementById('resetScoresBtn');

    let currentNumbers = [];
    let targetNumber = 0;
    let actualSolutions = [];
    let isActuallyHap = false;

    let scores = {
        player1: 0,
        player2: 0
    };

    function generateUniqueRandomNumbers(count, min, max) {
        const numbers = new Set();
        while (numbers.size < count) {
            numbers.add(Math.floor(Math.random() * (max - min + 1)) + min);
        }
        return Array.from(numbers);
    }

    function displayNumbers() {
        numberPoolDiv.innerHTML = '';
        currentNumbers.forEach(num => {
            const numDiv = document.createElement('div');
            numDiv.classList.add('number-item');
            numDiv.textContent = num;
            numberPoolDiv.appendChild(numDiv);
        });
        remainingCountSpan.textContent = currentNumbers.length;
    }

    function getAllPossible3Sums(numbers) {
        const sums = new Set();
        if (numbers.length < 3) return [];

        for (let i = 0; i < numbers.length - 2; i++) {
            for (let j = i + 1; j < numbers.length - 1; j++) {
                for (let k = j + 1; k < numbers.length; k++) {
                    sums.add(numbers[i] + numbers[j] + numbers[k]);
                }
            }
        }
        return Array.from(sums).sort((a, b) => a - b);
    }

    function generateTargetAndSolutions() {
        if (currentNumbers.length < 3) {
            targetNumberDisplayDiv.textContent = "-";
            isActuallyHap = false;
            actualSolutions = [];
            displayMessage("숫자가 부족하여 합/불 문제를 만들 수 없습니다. 새 세트를 시작하세요.", "info");
            return false;
        }

        const possibleSums = getAllPossible3Sums(currentNumbers);
        
        // 합/불이 적절히 섞이도록 조정
        const shouldBeHap = Math.random() < 0.6; // 60% 확률로 "합" 문제 시도

        if (possibleSums.length > 0 && shouldBeHap) {
            // "합" 문제 생성 시도
            targetNumber = possibleSums[Math.floor(Math.random() * possibleSums.length)];
            actualSolutions = findSumCombinations(currentNumbers, targetNumber);
            isActuallyHap = actualSolutions.length > 0;
             if (!isActuallyHap) { // 만약 조합을 못찾으면 (이론상 발생 안해야 함) "불"로 처리
                targetNumber = generateBelievableNonSum(possibleSums);
                isActuallyHap = false;
                actualSolutions = [];
            }
        } else {
            // "불" 문제 생성 시도 또는 possibleSums가 없을 때
             targetNumber = generateBelievableNonSum(possibleSums);
             isActuallyHap = false;
             actualSolutions = [];
        }
        
        targetNumberDisplayDiv.textContent = targetNumber;
        return true;
    }

    function generateBelievableNonSum(possibleSums) {
        // "불" 문제를 만들 때, 아예 터무니없는 숫자가 아닌, 있을 법하지만 없는 숫자를 생성
        let nonSumTarget;
        let attempts = 0;
        const minNum = Math.min(...currentNumbers);
        const maxNum = Math.max(...currentNumbers);

        // 대략적인 합의 범위 설정
        const minPossibleSum = currentNumbers.length >=3 ? currentNumbers.slice(0,3).reduce((a,b)=>a+b,0) : minNum * 3;
        const maxPossibleSum = currentNumbers.length >=3 ? currentNumbers.slice(-3).reduce((a,b)=>a+b,0) : maxNum * 3;


        do {
            nonSumTarget = Math.floor(Math.random() * (maxPossibleSum - minPossibleSum + 10)) + minPossibleSum -5; // 약간의 범위 확장
            if (nonSumTarget < 3) nonSumTarget = 3; // 최소 합은 1+1+1 (만약 숫자 범위가 1부터라면) 가정
            attempts++;
        } while (possibleSums.includes(nonSumTarget) && attempts < 50); // 50번 시도 후에도 못찾으면 그냥 진행

        // 그래도 못찾으면 (possibleSums가 너무 촘촘하거나 할 경우)
        if (possibleSums.includes(nonSumTarget)) {
            if (possibleSums.length > 0) {
                 nonSumTarget = Math.max(...possibleSums) + Math.floor(Math.random()*3)+1; // 가장 큰 합보다 조금 더 크게
            } else {
                 nonSumTarget = currentNumbers.reduce((a,b)=>a+b,0) + 10; // 모든 숫자의 합 + 10 (터무니 없지만 확실한 불)
            }
        }
        return nonSumTarget;
    }


    function findSumCombinations(numbers, target) {
        const solutions = [];
        const n = numbers.length;
        if (n < 3) return solutions;

        // 중복 조합을 피하기 위해 먼저 숫자를 정렬 (이미 정렬된 상태로 들어올 수도 있지만, 안전하게)
        const sortedNumbers = [...numbers].sort((a,b) => a-b);

        for (let i = 0; i < n - 2; i++) {
            for (let j = i + 1; j < n - 1; j++) {
                for (let k = j + 1; k < n; k++) {
                    if (sortedNumbers[i] + sortedNumbers[j] + sortedNumbers[k] === target) {
                        solutions.push([sortedNumbers[i], sortedNumbers[j], sortedNumbers[k]]);
                    }
                }
            }
        }
        // 이미 생성 로직에서 정렬된 숫자를 사용하므로, 추가적인 unique 처리는 findSumCombinations의 책임보다는
        // getAllPossible3Sums 에서 Set을 사용함으로써 sum 값의 유일성을 보장하고,
        // findSumCombinations는 해당 target에 대한 모든 조합 (정렬된 상태로)을 반환하는 것이 명확함.
        // 만약 동일한 숫자가 여러 개 있을 수 있는 경우라면 unique 처리가 더 복잡해지나, 현재는 unique random number이므로 간단.
        return solutions;
    }

    function startNewSet() {
        currentNumbers = generateUniqueRandomNumbers(8, 1, 20); // 숫자 범위 1~20으로 약간 늘림
        currentNumbers.sort((a,b)=>a-b); // 생성 후 정렬
        displayNumbers();
        if (generateTargetAndSolutions()) {
             displayMessage("새로운 숫자 세트와 목표 숫자가 준비되었습니다.", "info");
        }
        nextProblemBtn.disabled = false;
        hapBtn.disabled = false;
        boolBtn.disabled = false;
        revealAnswerBtn.disabled = false;
    }

    function nextProblem() {
        if (currentNumbers.length <= 5) { // 5개일 때가 마지막 문제, 그 다음 누르면 새 세트
            displayMessage("라운드 종료! 새로운 숫자 8개로 시작합니다.", "info");
            startNewSet();
            return;
        }

        if (currentNumbers.length > 3) { // 최소 3개는 있어야 합을 만들 수 있음
            const removeIndex = Math.floor(Math.random() * currentNumbers.length);
            const removedNumber = currentNumbers.splice(removeIndex, 1)[0];
            displayNumbers();
            if (generateTargetAndSolutions()) {
                displayMessage(`${removedNumber}이(가) 제거되었습니다. 현재 ${currentNumbers.length}개 숫자. 새 목표 숫자가 설정되었습니다.`, "info");
            }
        } else {
             displayMessage("더 이상 숫자를 제거할 수 없습니다 (최소 3개). 새 숫자 세트를 시작하세요.", "error");
             nextProblemBtn.disabled = true;
        }
        hapBtn.disabled = false;
        boolBtn.disabled = false;
        revealAnswerBtn.disabled = false;
    }
    
    function handlePlayerCall(isHapCall) {
        if (targetNumberDisplayDiv.textContent === '?' || targetNumberDisplayDiv.textContent === '-') {
            displayMessage("먼저 게임을 시작하거나 다음 문제를 진행해주세요.", "error");
            return;
        }

        let correctCall;
        let messageText;

        if (isHapCall) { // 플레이어가 "합"을 외침
            correctCall = isActuallyHap;
            if (correctCall) {
                messageText = `정답! "합"이 맞습니다. (예: ${actualSolutions[0].join(' + ')} = ${targetNumber})`;
                displayMessage(messageText, "success");
            } else {
                messageText = `땡! 실제로는 "불"입니다. 이 숫자들로 ${targetNumber}을 만들 수 없습니다.`;
                displayMessage(messageText, "error");
            }
        } else { // 플레이어가 "불"을 외침
            correctCall = !isActuallyHap;
            if (correctCall) {
                messageText = `정답! "불"이 맞습니다. 이 숫자들로 ${targetNumber}을 만들 수 없습니다.`;
                displayMessage(messageText, "success");
            } else {
                messageText = `땡! 실제로는 "합"입니다. (예: ${actualSolutions[0].join(' + ')} = ${targetNumber})`;
                displayMessage(messageText, "error");
            }
        }
        // 사회자가 정오답을 확인했으므로, 다음 문제로 넘어가거나 정답을 공개할 때까지 버튼 비활성화
        hapBtn.disabled = true;
        boolBtn.disabled = true;
        // revealAnswerBtn.disabled = true; // 정답 공개는 계속 가능하게 둘 수 있음
    }

    hapBtn.addEventListener('click', () => handlePlayerCall(true));
    boolBtn.addEventListener('click', () => handlePlayerCall(false));

    revealAnswerBtn.addEventListener('click', () => {
        if (targetNumberDisplayDiv.textContent === '?' || targetNumberDisplayDiv.textContent === '-') {
            displayMessage("먼저 게임을 시작하거나 다음 문제를 진행해주세요.", "error");
            return;
        }
        if (isActuallyHap) {
            let solutionString = actualSolutions.map(sol => sol.join(' + ')).join(' 또는 ');
            displayMessage(`정답은 "합"입니다. 가능한 조합: ${solutionString} = ${targetNumber}`, "info");
        } else {
            displayMessage(`정답은 "불"입니다. ${targetNumber}을 만들 수 있는 조합이 없습니다.`, "info");
        }
        hapBtn.disabled = true;
        boolBtn.disabled = true;
    });

    window.updateScore = function(player, change) {
        scores[player] += change;
        document.getElementById(`${player}Score`).textContent = scores[player];
    }

    resetScoresBtn.addEventListener('click', () => {
        scores.player1 = 0;
        scores.player2 = 0;
        document.getElementById('player1Score').textContent = 0;
        document.getElementById('player2Score').textContent = 0;
        displayMessage("점수가 초기화되었습니다.", "info");
    });

    function displayMessage(msg, type = "info") {
        messageAreaDiv.textContent = msg;
        messageAreaDiv.className = 'message'; // Reset classes
        if (type) {
            messageAreaDiv.classList.add(type);
        }
    }

    startNewSetBtn.addEventListener('click', startNewSet);
    nextProblemBtn.addEventListener('click', nextProblem);
    
    // 초기 상태 설정
    displayMessage("새 숫자 세트 시작 버튼을 눌러 게임을 시작하세요.", "info");
    targetNumberDisplayDiv.textContent = '?';
    nextProblemBtn.disabled = true;
    hapBtn.disabled = true;
    boolBtn.disabled = true;
    revealAnswerBtn.disabled = true;
});
    </script>
</body>
</html>